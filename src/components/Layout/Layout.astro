---
import '../../styles/global.css';

import Header from './Header.astro';
import Footer from './Footer.astro';

import type { ImageMetadata } from 'astro';
import defaultEyecatchMeta from '../../assets/default-eyecatch.png';
import defaultOGPImageMeta from '../../assets/scenery-2025.jpg';

const defaultSite = 'https://aktars-blog.com';

const siteValue = (Astro.site ?? defaultSite).toString();
const siteUrl = siteValue.endsWith('/') ? siteValue.slice(0, -1) : siteValue;

const { title, eyecatch } = Astro.props as {
    title?: string;
    eyecatch?: string | ImageMetadata;
};

const pathname = Astro.url.pathname;

// ホームかどうか
const isHome = pathname === '/';

const siteName = "akTAR.'s Blog";

// まず、デフォルトの fallback を決める
// ホームなら defaultOGPImageMeta、それ以外は defaultEyecatchMeta
const fallbackMeta = isHome ? defaultOGPImageMeta : defaultEyecatchMeta;

// 絶対URL化
const toAbs = (p?: string) => (p ? new URL(p, siteUrl).toString() : undefined);

let ogImageUrl: string | undefined;

// ユーザー指定が string の場合
if (typeof eyecatch === 'string') {
    ogImageUrl = toAbs(eyecatch);
}
// ユーザー指定が ImageMetadata の場合
else if (eyecatch && typeof eyecatch === 'object' && 'src' in eyecatch) {
    ogImageUrl = toAbs(eyecatch.src);
}

// 未指定なら fallback を適用
ogImageUrl = ogImageUrl ?? toAbs(fallbackMeta.src)!;

const fullTitle = title ? `${title} | ${siteName}` : siteName;
---

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{fullTitle}</title>
        <link rel="icon" href="/favicon.ico" sizes="any">
        <link rel="sitemap" href="/sitemap-index.xml" />

        <!-- OGP用metaタグ -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={Astro.site} />
        <meta property="og:title" content={fullTitle} />
        <meta property="og:image" content={ogImageUrl} />

        <!-- Twitterカード用metaタグ -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={fullTitle} />
        <meta name="twitter:image" content={ogImageUrl} />

        <meta name="google-site-verification" content="AcC0sdsh5MDwWEcvfDvnXdv6aDiSeUv93yuKN75PBWA" />
    </head>
    <body class="flex flex-col min-h-screen">
        <!-- ヘッダー -->
        <Header />

        <!-- メインコンテンツ -->
        <main class="flex-grow container mx-auto max-w-6xl px-4 sm:px-6 md:px-8 py-4">
        <slot />
        </main>

        <!-- フッター -->
        <Footer />
    </body>
</html>
