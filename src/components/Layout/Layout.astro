---
import '../../styles/global.css';

import Header from './Header.astro';
import Footer from './Footer.astro';

import type { ImageMetadata } from 'astro';
import defaultEyecatchMeta from '../../assets/default-eyecatch.png';

const defaultSite = 'https://aktardigrade13-blog.pages.dev';

const siteValue = (Astro.site ?? defaultSite).toString();
const siteUrl = siteValue.endsWith('/') ? siteValue.slice(0, -1) : siteValue;

const { title, eyecatch } = Astro.props as {
    title?: string;
    eyecatch?: string | ImageMetadata;
};

const toAbs = (p?: string) => (p ? new URL(p, siteUrl).toString() : undefined);

// OGP用の最終URLを決定
// 1) string 指定ならその文字列を絶対化
// 2) ImageMetadata 指定なら .src を絶対化
// 3) 未指定ならデフォルト ImageMetadata の .src を絶対化
const ogImageUrl =
    typeof eyecatch === 'string'
        ? toAbs(eyecatch)!
        : toAbs((eyecatch ?? defaultEyecatchMeta).src)!;

const fullTitle = title ? `${title} - ${siteUrl}` : siteUrl;
---

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{fullTitle}</title>
        <link rel="icon" href="/読書のアイコン.png" type="image/png" />
        <link rel="sitemap" href="/sitemap-index.xml" />

        <!-- OGP用metaタグ -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={Astro.site} />
        <meta property="og:title" content={fullTitle} />
        <meta property="og:image" content={ogImageUrl} />

        <!-- Twitterカード用metaタグ -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={fullTitle} />
        <meta name="twitter:image" content={ogImageUrl} />

        <meta name="google-site-verification" content="AcC0sdsh5MDwWEcvfDvnXdv6aDiSeUv93yuKN75PBWA" />
    </head>
    <body class="flex flex-col min-h-screen">
        <!-- ヘッダー -->
        <Header />

        <!-- メインコンテンツ -->
        <main class="flex-grow container mx-auto max-w-6xl px-4 sm:px-6 md:px-8 py-4">
        <slot />
        </main>

        <!-- フッター -->
        <Footer />
    </body>
</html>
